<!doctype html><title>Cloud with firework.js</title>
<script src="../vendor/tquery-bundle.js"></script>

<script src="../../src/core.js"></script>
<script src="../../src/emitter.js"></script>
<script src="../../src/particle.js"></script>
<script src="../../src/effect.js"></script>
<script src="../../src/spawner.js"></script>
<script src="../../src/shape.js"></script>
<script src="../../src/vector.js"></script>

<script src="../plugins/effect.base.js"></script>
<script src="../plugins/effect.age.js"></script>
<script src="../plugins/spawner.rate.js"></script>
<script src="../plugins/spawner.oneshot.js"></script>
<script src="../plugins/shape.sphere.js"></script>
<script src="../plugins/effect.applyForce.js"></script>
<script src="../plugins/effect.init2shapes.js"></script>
<script src="../plugins/effect.shape.box.js"></script>
<script src="../plugins/effect.dieifcontained.js"></script>

<script src="./fireworks.renderer.tquerysprite.js"></script>

<body><script>
	var world	= tQuery.createWorld().boilerplate().start();
	var object	= tQuery.createTorus().addTo(world).translateY(-0.5);


	world.getCameraControls().rangeX	= 4;
	world.getCameraControls().rangeY	= 4;
	world.renderer().setClearColorHex( 0xbbbbbb, 1 );

	var emitter	= new Fireworks.Emitter({
		nParticles	: 100
	});
	emitter.setSpawner(new Fireworks.SpawnerRate( 10 ));
	
	
	var texture	= THREE.ImageUtils.loadTexture( "../assets/images/cloud10.png" );

	emitter.pushRendererTquery({
		createObject3d	: function(){
			var param	= {
				map			: texture,
				useScreenCoordinates	: false,
				//color			: 0x010101*Math.floor(255*(Math.random()*0.2+0.8)),
				//color			: 0x010101*Math.floor(255*(Math.random()*0.2+0.2)),
				//color			: 0xFFFFFF,
			};
			var sprite		= new THREE.Sprite( param );
			var object3d		= tQuery(sprite);
			return object3d;			
		}
	})
	emitter.pushBase();
	emitter.pushAge(3);
	
	Fireworks.createEffect().onBirth(function(particle){
		var xBase	= emitter.getParticleData(particle, 'xBase')
		xBase.position.x	= (Math.random()*2 - 1)*0.1;
		xBase.position.y	= (Math.random()*2 - 1)*0.1;
		xBase.position.z	= (Math.random()*2 - 1)*0.1;		

		xBase.velocity.x	= (Math.random()*2 - 1)*0.002;
		xBase.velocity.y	= (Math.random()*1 - 0)*0.01;
		xBase.velocity.z	= (Math.random()*2 - 1)*0.002;		
		//xBase.velocity.set(0,0,0);
		
		xBase.friction	= 1;
	}).pushTo(emitter);
	Fireworks.createEffect().onBirth(function(particle){
		var object3d	= emitter.getParticleData(particle, 'xTquery').object3d;
		object3d.scale(1/300 * (Math.random() * 0.4 + 0.8))
		var sprite	= object3d.get(0);
		sprite.color.setHex( 0x010101*Math.floor(255*(Math.random()*0.2+0.2)) );
	}).onUpdate(function(particle){
		var object3d	= emitter.getParticleData(particle, 'xTquery').object3d;
		var sprite	= object3d.get(0);
		object3d.scaleBy(1.003);
	}).pushTo(emitter);

	emitter.start();
	
	world.loop().hook(function(deltaTime){
		emitter.update(deltaTime).render();
	})
</script></body>