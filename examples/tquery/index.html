<!doctype html><title>Minimal tQuery Page</title>
<script src="./tquery-bundle.js"></script>

<script src="../../src/core.js"></script>
<script src="../../src/emitter.js"></script>
<script src="../../src/particle.js"></script>
<script src="../../src/effect.js"></script>
<script src="../../src/spawner.js"></script>
<script src="../../src/shape.js"></script>
<script src="../../src/vector.js"></script>
<script src="../../src/plugins/effect.base.js"></script>
<script src="../../src/plugins/effect.age.js"></script>
<script src="../../src/plugins/spawner.rate.js"></script>
<script src="../../src/plugins/shape.sphere.js"></script>

<script src="../canvas/effect.applyForce.js"></script>
<script src="../canvas/effect.init2shapes.js"></script>
<script src="../canvas/effect.shape.box.js"></script>
<script src="../canvas/effect.dieifcontained.js"></script>

<script src="./fireworks.effect.tquery.js"></script>

<body><script>
	var world	= tQuery.createWorld().boilerplate().start();
	var object	= tQuery.createTorus().addTo(world);
	object.rotateX(Math.PI/6)

	world.renderer().setClearColorHex( 0x000000, world.renderer().getClearAlpha() );

	var emitter	= new Fireworks.Emitter({
		nParticles	: 100
	});
	emitter.setSpawner(new Fireworks.SpawnerRate(30));
	emitter.pushTquery().pushBase().pushAge(0.8);
	
	emitter.pushInit2Shapes({
		origin	: Fireworks.createSphere(0, 0, 0, 0.1),
		target	: Fireworks.createSphere(0, 40, -60, 20),
		speed	: 0.15*2
	});
	emitter.effects().push({ onUpdate: function(particle){
		var ctx	= emitter.getParticleData(particle, 'xBase')
		ctx.acceleration.y	-= 0.0001;
	}});
	emitter.effects().push({
		onBirth: function(particle){
			var xTquery	= emitter.getParticleData(particle, 'xTquery')
			var tObject3d	= xTquery.object3d.get(0);
			var scale	= 1/10;
			tObject3d.scale.set(scale, scale, scale)
		},
		onUpdate: function(particle){
			var xBase	= emitter.getParticleData(particle, 'xBase')
			var xTquery	= emitter.getParticleData(particle, 'xTquery')
			var tObject3d	= xTquery.object3d.get(0);
			var scale	= tObject3d.scale.x;
			scale		+= 0.005/4;
			tObject3d.scale.set(scale, scale, scale)
		}
	});
	emitter.pushDieIfContained(Fireworks.createBox(0, -5, 0, 100, 10, 100));

	emitter.start();
	
	world.loop().hook(function(deltaTime){
		emitter.update(deltaTime);
		render(emitter);
	})
	
	function render(emitter){
		// set the fillStyle of the particles
		emitter.liveParticles().forEach(function(particle){
			var xBase	= particle.xBase;
			var xTquery	= particle.xTquery;
			var position	= xBase.position;
			var tObject3d	= xTquery.object3d.get(0);
			tObject3d.position.set(position.x, position.y, position.z);
		});
	}


</script></body>